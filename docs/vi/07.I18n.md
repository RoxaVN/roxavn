## Giới thiệu

RoxaVN hỗ trợ **đa ngôn ngữ (i18n)** thông qua thư viện [**i18next**](https://www.i18next.com/), giúp bạn dễ dàng xây dựng ứng dụng có thể thay đổi ngôn ngữ linh hoạt theo người dùng.

Mỗi **module** trong RoxaVN tương ứng với **một namespace** trong i18next.
Điều này có hai lợi ích chính:

1. Tối ưu hiệu suất tải — chỉ tải file dịch của module đang được sử dụng, thay vì tải tất cả.
2. Tách biệt ngữ cảnh dịch — tránh trùng key giữa các module.

> ⚠️ **Lưu ý:**  
> Vì tên module trong RoxaVN có thể chứa dấu `/`, nên nếu dùng trực tiếp làm đường dẫn tải file dịch sẽ gây sai lệch URL.  
> Do đó, **namespace** trong i18next sẽ được sử dụng dưới dạng **tên module đã được escape**.  
> Ví dụ, module `@roxavn/module-user` sẽ có namespace là *@roxavn@module-user*, và module `@roxavn/module-workflow` có namespace là *@roxavn@module-workflow*.

### Cấu trúc thư mục ngôn ngữ

Mỗi module sẽ chứa các file dịch trong thư mục:

```
static/locales/{language-code}.json
```

Ví dụ cho module `user`:

```
@roxavn/module-user/
└── static/
    └── locales/
        ├── en.json
        └── vi.json
```

Khi bạn cập nhật nội dung trong các file dịch, cần chạy lại lệnh `npx roxavn sync -i`. Lệnh này sẽ đồng bộ dữ liệu dịch từ file gốc `static/locales/en.json` sang thư mục `.web/i18n/`. Mục đích của việc này là để tự động sinh và cập nhật kiểu dữ liệu (TypeScript types) cho các key trong file dịch, giúp việc sử dụng hàm `t()` có **kiểm tra kiểu an toàn** và **gợi ý tự động trong IDE**.

### Ví dụ

**`static/locales/en.json`**

```json
{
  "username": "Username",
  "password": "Password",
  "login": "Login"
}
```

**`static/locales/vi.json`**

```json
{
  "username": "Tên đăng nhập",
  "password": "Mật khẩu",
  "login": "Đăng nhập"
}
```

## Frontend

RoxaVN cung cấp nhiều cách để hiển thị nội dung đa ngôn ngữ, linh hoạt cho cả **hook** và **component** trong React.

### Sử dụng với hook

Bạn có thể dùng hook `useTranslation()` của module để lấy hàm `t()` phục vụ việc dịch văn bản trong component.

```tsx
function Component() {
  const { t } = webModule.useTranslation();
  return <div>{t('key', options)}</div>;
}
```

* `key`: là khóa trong file dịch (`static/locales/{lang}.json`)
* `options`: là các tham số truyền vào khi cần nội suy (optional)

### Sử dụng với component `<Translation />`

Nếu bạn muốn hiển thị nội dung dịch trực tiếp trong JSX mà không cần gọi hook, có thể dùng component `Translation`:

```tsx
import { Translation } from '@roxavn/core/web';

<Translation module={webModule} k="add" options={options} />;
```

### Sử dụng khi chỉ có tên module

Trong một số trường hợp, bạn không có tham chiếu trực tiếp đến `webModule` mà chỉ có **tên module**, bạn vẫn có thể thực hiện dịch thông qua:

```tsx
import { TranslationWithModuleName, WebModule } from '@roxavn/core/web';

// Component hiển thị trực tiếp
<TranslationWithModuleName moduleName={moduleName} k={key} options={options} />;

// Hoặc dùng hook
const { t } = WebModule.useTranslation(moduleName);
```

Cách này hữu ích khi module được xác định **động** hoặc **import chéo** giữa các module khác nhau.

## Backend

Thông thường, việc hiển thị đa ngôn ngữ sẽ do frontend đảm nhận. Tuy nhiên, trong một số trường hợp đặc biệt, backend cũng cần thực hiện việc dịch — ví dụ như gửi thông báo đẩy (push notification) đến người dùng, nơi nội dung cần được dịch sẵn trước khi gửi đi.

### Cách sử dụng

Bạn có thể lấy hàm dịch `t()` thông qua `getFixedT()` như sau:

```ts
const t = await serverModule.getFixedT('en');
const message = t('notification.newMessage');
```

* `'en'` là mã ngôn ngữ cần dịch.
* `t('key')` hoạt động tương tự như trên frontend, lấy giá trị theo khóa dịch trong file `static/locales/en.json`.

### Dịch khi chỉ có tên module

Trong trường hợp bạn không có tham chiếu trực tiếp đến `serverModule`, mà chỉ có **tên module**, có thể sử dụng hàm tĩnh từ `ServerModule`:

```ts
import { ServerModule } from '@roxavn/core/server';

const t = await ServerModule.getFixedT(moduleName, lang);
const message = t('notification.newMessage');
```

## Namespace Meta

Mỗi module trong RoxaVN cần khai báo thêm một namespace đặc biệt có tên là **`Meta`** trong file dịch để cung cấp thông tin mô tả cơ bản cho module. Ví dụ cấu trúc file `static/locales/en.json`:

```json
{
  "Meta": {
    "name": "User",
    "description": "System account management"
  }
}
```

### Ý nghĩa các trường

* **`name`** – Tên hiển thị của module.
* **`description`** – Mô tả ngắn gọn về chức năng hoặc phạm vi của module.

### Mục đích

Trang `/admin/apps` trong RoxaVN hiển thị danh sách các module cài đặt trong hệ thống.
Tuy nhiên, để tránh việc phải tải toàn bộ file dịch của tất cả module, RoxaVN sẽ tự động tổng hợp thông tin trong namespace **`Meta`** thành **một namespace đặc biệt** dùng riêng cho metadata.

Điều này giúp việc hiển thị tên và mô tả module trở nên nhẹ, nhanh và có thể truy cập trực tiếp.

### Cách sử dụng trong frontend

Bạn có thể lấy thông tin `name` hoặc `description` của module qua hook `useMetaTranslation`:

```tsx
import { useMetaTranslation } from '@roxavn/core/web';

function Component({ moduleName }: { moduleName: string }) {
  const { t } = useMetaTranslation();

  return (
    <div>
      <h3>{t(`${moduleName}.name`)}</h3>
      <p>{t(`${moduleName}.description`)}</p>
    </div>
  );
}
```

Cách này đảm bảo ứng dụng của bạn chỉ tải thông tin metadata cần thiết mà không phải tải toàn bộ file dịch của module.
